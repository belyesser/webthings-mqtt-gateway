'@context': https://iot.mozilla.org/schemas/
'@type':
  - BinarySensor
id: paz
title: Paz-Handy
description: User tracking using OwnTracks
location: owntracks
mqtt:
  propertyDefaults:
    statusTopic: "{{.thing.ID}}/status/{{.thing.Location}}/{{.item.ID}}"
    statusHandler:
      type: json-extended
properties:
  phone_power:
    '@type': LevelProperty
    unit: percent
    minimum: 0
    maximum: 100
    multipleOf: 1
    title: Telefon-Akku
    readOnly: true
  is_home:
    title: Zuhause
    '@type': BooleanProperty
    readOnly: true
    mqtt:
      statusHandler:
        type: lua
        content: json
        return: value.val == 1 
  location:
    '@type': OHLocationProperty
    title: GPS-Koordinaten
    type: object
    readOnly: true
    mqtt:
      statusHandler:
        type: lua
        content: json
        code: |
          local t = {}
          for str in string.gmatch(value.val, "([^,]+)") do
            table.insert(t, str)
          end
          return map({ latitude=t[1] , longitude=t[2] , precision=t[3] })